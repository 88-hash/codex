## 二、顾客端（C 端）模块设计

### 1. 认证与用户模块

**功能裁剪与优化**

- 保留：手机号验证码一键登录，**首次即注册**（免注册页面）。  
- 去掉：密码登录、复杂资料、收货地址管理（只有线下自提）。  
- 记住手机号（本地缓存），方便回头客。  

**交互流程**

1. 输入手机号 → 点击获取验证码 → 输入验证码 → 登录成功。  
2. 首次登录：自动在 `user` 表插入记录；再次登录：只更新 `updated_at` 作为活跃时间。  

**涉及表与核心字段**

- `user(id, phone, name, avatar, created_at, updated_at)`  

**权限说明**

- 仅顾客端使用；B 端只看手机号，不管理会员等级等复杂逻辑。  

***

### 2. 商品浏览模块

**功能裁剪与优化**

- 分类：仅二级分类，示例：零食/饮料/日用 → 每个下面若干小类（饼干、糖果等）。  
- 商品列表：网格展示，支持分类筛选 + 上拉分页。  
- 商品详情：主图轮播 + 价格 + 库存 + 促销标签（如“第二件半价”可用简单字符串）+ 简单文字描述。  
- 搜索：关键词模糊搜索（按名称、条码等），不做热词推荐。  

**流程**

1. 顾客进入首页 → 选择一级分类 → 选择二级分类 → 查看商品列表。  
2. 点击商品 → 查看详情 → 加入购物车或返回。  
3. 输入关键词搜索 → 展示搜索结果。  

**涉及表与核心字段**

- `category(id, parent_id, name, sort, created_at, updated_at)`  
- `goods(id, category_id, name, price, stock, bar_code, image_url, description, is_on_sale, expire_date, created_at, updated_at)`  

***

### 3. 购物车模块

**保留内容**

- 基础功能：加入购物车、修改数量、删除、全选、勾选结算。  
- 失效商品：商品下架或删除时在购物车里标记“已失效”，不让结算。  

**流程**

1. 商品详情 → 点击“加入购物车”，若已存在则数量 +1。  
2. 购物车页：  
   - 列出所有条目（商品名称、价格、库存、是否有效）。  
   - 支持数量加减、删除、全选、勾选部分结算。  
3. 结算前实时校验库存：若数量 > 库存 → 给出提示并自动调到最大可买数量。  

**涉及表与核心字段**

- `cart(id, user_id, goods_id, quantity, is_checked, created_at, updated_at)`  

***

### 4. 下单与取货码模块（到店付）

**功能裁剪与优化**

- 收货信息简化为：**门店地址（固定文案） + 取货人手机号（=用户手机号）**。  
- 支付方式固定为“到店支付”，系统不记支付状态，只记录订单状态与核销状态。  
- 生成取货码：  
  - 系统展示的取货码采用**短码**（6–8 位数字）方便口报；  
  - `order_no` 使用 `LY + 年月日 + 4 位序号` 便于对账，比如 `LY202504050001`。  

**流程**

1. 顾客在购物车勾选商品 → 点击“去结算”。  
2. 结算页：展示商品清单、总价、门店地址、手机号（不可改或可改但仅用于本单联系）+ 备注。  
3. 点击“提交订单”：  
   - 写入 `order`（主表）+ `order_item`（明细表）；  
   - 订单状态初始为“待取货”；  
   - 生成：  
     - `order_no`（完整单号）；  
     - `verify_code`（短数字码，如 6 位）。  
4. 成功页：大号展示取货码 + 按钮“复制” + 引导用户截图。  

**涉及表与核心字段**

- `order(id, user_phone, order_no, total_price, status, verify_code, remark, created_at, verify_time, updated_at)`  
  - `status`：待取货 / 已完成 / 已取消（顾客取消或店长取消）。  
- `order_item(id, order_id, goods_id, goods_name, price, quantity, subtotal, created_at, updated_at)`  

***

### 5. 订单管理模块（顾客端）

**功能**

- 订单列表：按状态筛选：待取货 / 已完成 / 已取消。  
- 订单详情：展示取货码、订单信息、商品详情、备注。  
- 功能按钮：  
  - 待取货状态：允许顾客**自行取消订单**（一定时间内，比如 30 分钟内，逻辑可在 B 端规则里写清）。  
  - 已完成：展示“去评价”（跳转评价模块）。  

**流程**

1. 顾客 → 我的订单 → 查看各状态订单。  
2. 点进详情：查看取货码（可再复制或截图）。  
3. 顾客主动取消：更新 `order.status` 为“已取消”，**不做退款逻辑**（因为未支付）。  

***

### 6. 评价模块（商品维度）

**功能**

- 仅对“已完成”的订单商品评价，**一件商品一条评价**。  
- 内容：星级评分 + 文本（300 字以内），不支持图片、追评。  

**流程**

1. 顾客完成取货后，订单状态变为“已完成”。  
2. 在订单详情或列表点击“评价” → 展示该订单中商品列表。  
3. 选择某个商品 → 填写星级 + 文本 → 提交。  

**涉及表与核心字段**

- `comment(id, order_item_id, user_phone, rating, content, created_at, updated_at)`  

***

### 7. 个人中心模块（顾客端）

**功能简化**

- 只保留：手机号、昵称、头像（头像/昵称可选修改）。  
- 展示“我的评价”，方便顾客查看历史评价。  

**流程**

1. 个人中心首页：显示头像、昵称、手机号、订单入口、评价入口。  
2. 点击“我的评价”：按时间列出评价记录（商品名、星级、简单内容）。  

**涉及表**

- `user`（更新 name、avatar）。  
- `comment`（查询我的评价）。  

***

## 三、店家端（B 端）模块设计

> B 端分角色：**店长（Admin-Manager）**、**店员（Admin-Clerk）**。  
> 采用简单 RBAC：只标记角色，不做复杂权限表。  

### 1. 登录与权限模块

**功能**

- 账号密码登录（手机号 + 密码）。  
- 根据角色决定进入店长后台还是店员后台菜单。  

**涉及表**

- `admin(id, name, phone, password, role, created_at, updated_at)`  
  - `role`：manager / clerk。  

***

### 2. 商品管理模块（店长专属）

**功能**

- 商品新增：名称、分类（二级）、价格、库存、条码、主图、保质期日期。  
- 编辑：修改上述信息。  
- 上下架：`is_on_sale` 字段控制，C 端仅展示上架商品。  
- 删除：软删建议用 `is_deleted` 字段，或直接物理删除（毕设可选）。  
- 条码管理：支持手动录入条码，方便将来跟扫码枪集成。  

**线下店考虑**

- 大部分零食有条码，录入条码后可以用扫码枪快速补货录入、盘点。  
- `expire_date` 用于临期预警。  

**涉及表**

- `goods`  
- `category`（分类下拉使用）  

***

### 3. 分类管理模块（店长专属）

**功能**

- 支持二级分类结构：  
  - 一级：零食/饮料/日用  
  - 二级：饼干、薯片、碳酸饮料、纸巾等。  
- 操作：新增、修改名称、删除（删除时检查是否有商品挂载）。  

**涉及表**

- `category(id, parent_id, name, sort, created_at, updated_at)`  

***

### 4. 订单核销模块（店长 + 店员共用）

**这是线下实体店最关键模块之一。**[2][7][8][9]

**核心功能**

- 订单列表：按状态筛选：待核销（=待取货）/ 已核销（已完成）/ 已取消。  
- 订单详情：显示订单号、取货码、顾客手机号、商品清单、备注。  
- 核销方式：**手动输入取货码**（可日后扩展扫码）。  
- 核销日志：记录谁在什么时间核销了哪个订单，以及操作类型（核销/取消）。  
- 取消订单：  
  - 店长可进行“后台取消”，标记为“已取消 + 待退款备注”；  
  - 退款动作在线下收银台处理，本系统只做记录。  

**核销流程（店员视角）**

1. 顾客到店 → 报取货码或报手机号。  
2. 店员打开 B 端 → 进入“订单核销” → 输入取货码。  
3. 系统校验：  
   - 若订单不存在 / 状态非“待取货” → 提示错误，防止重复核销。  
   - 若正常：弹出核对信息：顾客手机号 + 商品列表 + 总价。  
4. 店员与顾客实物对账 → 确认无误后点击“确认核销”。  
5. 系统执行：  
   - 更新 `order.status` 为“已完成”；  
   - 记录 `order.verify_time`；  
   - 写入一条 `verify_log`（action=核销，记录当前 admin）。  

**店长取消流程**

1. 在订单列表中选择某订单（通常是顾客未到店、或者在顾客端取消后跟进）。  
2. 点击“取消订单”：  
   - 更新 `order.status` 为“已取消”；  
   - 写一条 `verify_log`（action=取消，remark 写“顾客未到店”或“线下退款完成”等）。  

**涉及表与核心字段**

- `order`  
- `order_item`  
- `verify_log(id, order_id, admin_id, verify_time, action, remark)`  

***

### 5. 经营数据统计模块（店长专属）

**目的：给店长一个简洁但有“管理感”的仪表板。**[5][6][10][11][4]

**统计维度**

1. 今日营业额  
   - 计算公式：**今日已核销订单总金额**（`status=已完成` AND `verify_time` 在今日）。  
2. 商品销量 Top10  
   - 统计区间可选：今日 / 本周 / 本月；按 `order_item` 聚合出售数量。  
3. 库存预警列表  
   - 条件：`stock < safety_stock`（可将安全库存阈值简单写在 `goods`，或统一设置常量）。  
4. 临期商品预警  
   - 条件：`expire_date` 距当前日期小于 N 天（如 30 天），且未下架。  
5. 周/月营业趋势图  
   - 显示近 7 天或近 30 天的每日营业额折线图，数据来自已完成订单。  
6. 核销转化率  
   - 今日下单数（新建订单数） vs 今日核销数（`status=已完成` 的订单数），计算核销率＝核销数 / 下单数。  

**线下店真实价值**

- 店长每天关心“今天卖了多少钱”“爆款是什么”“哪些快没货/要过期”。  
- 这些报表不需要特别华丽，只要简洁实用就足够支撑毕设展示。  

**涉及表**

- `order`  
- `order_item`  
- `goods`  

***

### 6. 店员管理模块（店长专属）

**功能**

- 增加店员：姓名 + 手机号 + 角色（店长/店员）+ 初始密码。  
- 编辑店员：修改姓名、手机号、角色、重置密码。  
- 删除店员：逻辑删除或物理删除均可。  

**线下考虑**

- 小店一般只有 1 个店长 + 若干兼职店员，简单角色足够，不做复杂权限细颗粒控制。  

**涉及表**

- `admin`  

***

## 四、数据库表（10 张）与核心字段整理

| 表名 | 作用 | 关键字段示例 |
|------|------|--------------|
| user | 顾客信息 | id, phone, name, avatar, created_at, updated_at |
| admin | 店长/店员账号 | id, name, phone, password, role(manager/clerk), created_at, updated_at |
| category | 商品分类（支持二级） | id, parent_id, name, sort, created_at, updated_at |
| goods | 商品 | id, category_id, name, price, stock, bar_code, image_url, description, is_on_sale, expire_date, created_at, updated_at |
| goods_image | 商品轮播图 | id, goods_id, image_url, sort, created_at |
| cart | 购物车 | id, user_id, goods_id, quantity, is_checked, created_at, updated_at |
| order | 订单主表 | id, user_phone, order_no, total_price, status, verify_code, remark, created_at, verify_time, updated_at |
| order_item | 订单明细 | id, order_id, goods_id, goods_name, price, quantity, subtotal, created_at, updated_at |
| comment | 商品评价 | id, order_item_id, user_phone, rating, content, created_at, updated_at |
| verify_log | 核销日志 | id, order_id, admin_id, verify_time, action(核销/取消), remark |

> 说明：  
> - `goods_image` 用于支持商品详情轮播图，保持 10 表结构但实现较好的展示效果。  
> - 不再增加地址、优惠券、收藏等表，防止膨胀。  

***

## 五、主要业务流程梳理（线下实体场景）

### 1. 顾客下单与取货流程

1. 手机打开 C 端 → 手机号验证码登录（自动注册）。  
2. 浏览分类 → 选中商品 → 加入购物车。  
3. 购物车勾选商品 → 去结算 → 填写备注 → 提交订单。  
4. 系统生成订单：  
   - `order_no` 按规则 `LY+年月日+序号`；  
   - 生成短数字 `verify_code`；  
   - 状态为“待取货”。  
5. 成功页大号展示取货码，顾客可：  
   - 截图保存；  
   - 复制取货码；  
   - 在“我的订单”随时查看。  
6. 顾客到店 → 报取货码或报手机号 → 店员核销 → 线下收银台收款。  
7. 完成后顾客可在订单详情里对商品评价。  

### 2. 店员核销流程（到店收银）

1. 顾客来到门店 → 报取货码（推荐）或手机号。  
2. 店员打开 B 端 → 进入“订单核销”：  
   - 输入取货码 → 搜索订单。  
3. 系统校验：订单存在且状态 = 待取货，否则提示错误/已核销。  
4. 弹出订单信息：顾客手机号 + 商品清单 + 总价。  
5. 店员与实际商品对照无误 → 在收银台完成收款（现金/扫码，与本系统无关）。  
6. 店员在系统点击“确认核销”：  
   - 更新订单状态为“已完成”；  
   - 写入 `verify_time`；  
   - 插入 `verify_log`（action=核销，admin_id 为当前店员）。  
7. 顾客端“我的订单”中该订单状态自动变为“已完成”，可评价。  

### 3. 店长管理与统计流程

1. 每天开店前：  
   - 登录 B 端 → 查看“库存预警”和“临期预警” → 安排补货和促销。  
2. 营业中：  
   - 店员用“订单核销”模块完成取货核销；  
   - 核销日志持续累积，为对账与追责提供依据。  
3. 每天打烊后：  
   - 店长在“经营数据统计”查看：  
     - 今日营业额；  
     - 今日订单数、核销数、核销转化率；  
     - 今日热销 Top10。  
   - 如发现某店员异常核销，可根据 `verify_log` 对应订单明细进行核查。  
